# =============================================================================
# STOFLOW BACKEND - CONFIGURATION DÉVELOPPEMENT
# =============================================================================
# Copier ce fichier en .env et adapter les valeurs

# -----------------------------------------------------------------------------
# APPLICATION
# -----------------------------------------------------------------------------
APP_NAME=Stoflow
APP_ENV=development
DEBUG=true
API_HOST=0.0.0.0
API_PORT=8000
API_WORKERS=1

# -----------------------------------------------------------------------------
# DATABASE - PostgreSQL
# -----------------------------------------------------------------------------
DB_HOST=localhost
DB_PORT=5433
DB_NAME=stoflow_db
DB_USER=stoflow_user
DB_PASSWORD=stoflow_dev_password_2024
DATABASE_URL=postgresql://stoflow_user:stoflow_dev_password_2024@localhost:5433/stoflow_db

# Pool SQLAlchemy
DB_POOL_SIZE=5
DB_MAX_OVERFLOW=10
DB_POOL_TIMEOUT=30
DB_POOL_RECYCLE=3600

# -----------------------------------------------------------------------------
# JWT AUTHENTICATION
# -----------------------------------------------------------------------------
JWT_SECRET_KEY=your-super-secret-jwt-key-change-in-production-min-32-chars
JWT_ALGORITHM=HS256
JWT_ACCESS_TOKEN_EXPIRE_MINUTES=1440

# Rotation des secrets JWT (voir procédure ci-dessous)
# JWT_SECRET_KEY_PREVIOUS=  # Ancien secret pendant période de grâce (7 jours max)

# === PROCÉDURE DE ROTATION DES SECRETS JWT ===
# 1. Générer un nouveau secret: python -c "import secrets; print(secrets.token_urlsafe(64))"
# 2. Copier l'actuel JWT_SECRET_KEY vers JWT_SECRET_KEY_PREVIOUS
# 3. Mettre le nouveau secret dans JWT_SECRET_KEY
# 4. Redémarrer l'application
# 5. Attendre 7 jours (durée max du refresh token)
# 6. Supprimer JWT_SECRET_KEY_PREVIOUS
# ==============================================

# Password hashing
PASSWORD_HASH_ROUNDS=12

# -----------------------------------------------------------------------------
# ENCRYPTION - Chiffrement des données sensibles (tokens OAuth2)
# -----------------------------------------------------------------------------
# Clé Fernet pour chiffrer les tokens OAuth2 (eBay, Etsy) stockés en BDD
# Générer avec: python -c "from cryptography.fernet import Fernet; print(Fernet.generate_key().decode())"
# ENCRYPTION_KEY=your-fernet-key-here
# ENCRYPTION_KEY_PREVIOUS=  # Ancienne clé pendant rotation

# === PROCÉDURE DE ROTATION DES CLÉS DE CHIFFREMENT ===
# 1. Générer une nouvelle clé: python -c "from cryptography.fernet import Fernet; print(Fernet.generate_key().decode())"
# 2. Copier ENCRYPTION_KEY vers ENCRYPTION_KEY_PREVIOUS
# 3. Mettre la nouvelle clé dans ENCRYPTION_KEY
# 4. Redémarrer l'application (les anciennes données seront déchiffrées avec PREVIOUS)
# 5. Exécuter le script de re-chiffrement des données existantes
# 6. Supprimer ENCRYPTION_KEY_PREVIOUS
# =====================================================

# -----------------------------------------------------------------------------
# OPENAI - Génération Descriptions
# -----------------------------------------------------------------------------
OPENAI_API_KEY=sk-proj-your-openai-api-key-here
OPENAI_MODEL=gpt-4-turbo-preview
OPENAI_MAX_TOKENS=500
OPENAI_TEMPERATURE=0.7

# Cache IA
AI_CACHE_TTL_SECONDS=2592000  # 30 jours
AI_CACHE_ENABLED=true

# -----------------------------------------------------------------------------
# VINTED - Configuration Publication
# -----------------------------------------------------------------------------
VINTED_BASE_URL=https://www.vinted.fr
VINTED_API_URL=https://www.vinted.fr/api/v2

# Rate Limiting
VINTED_RATE_LIMIT_MAX=40
VINTED_RATE_LIMIT_WINDOW_HOURS=2
VINTED_REQUEST_DELAY_MIN_SECONDS=20
VINTED_REQUEST_DELAY_MAX_SECONDS=50

# Retry
VINTED_MAX_RETRIES=3
VINTED_RETRY_DELAY_SECONDS=60

# -----------------------------------------------------------------------------
# LOGGING
# -----------------------------------------------------------------------------
LOG_LEVEL=DEBUG
LOG_FORMAT=detailed
LOG_FILE_ENABLED=true
LOG_FILE_PATH=logs/stoflow.log
LOG_FILE_MAX_BYTES=10485760  # 10MB
LOG_FILE_BACKUP_COUNT=5

# -----------------------------------------------------------------------------
# CORS - Frontend URLs autorisées
# -----------------------------------------------------------------------------
CORS_ORIGINS=http://localhost:3000,http://localhost:8080
CORS_ALLOW_CREDENTIALS=true

# -----------------------------------------------------------------------------
# STRIPE - Paiements et Abonnements
# -----------------------------------------------------------------------------
STRIPE_SECRET_KEY=sk_test_your-stripe-secret-key-here
STRIPE_PUBLISHABLE_KEY=pk_test_your-stripe-publishable-key-here
STRIPE_WEBHOOK_SECRET=whsec_your-stripe-webhook-secret-here
FRONTEND_BASE_URL=http://localhost:3000

# -----------------------------------------------------------------------------
# MULTI-TENANT
# -----------------------------------------------------------------------------
TENANT_SCHEMA_PREFIX=client_
TENANT_MAX_SCHEMAS=1000

# -----------------------------------------------------------------------------
# EBAY - API Configuration
# -----------------------------------------------------------------------------
# Base URLs
EBAY_API_BASE=https://api.ebay.com
EBAY_SANDBOX_API_BASE=https://api.sandbox.ebay.com
EBAY_USE_SANDBOX=false

# Request Settings
EBAY_REQUEST_TIMEOUT=30
EBAY_API_LIMIT=100

# OAuth2 Scopes (17 scopes)
EBAY_SCOPE_API_SCOPE=https://api.ebay.com/oauth/api_scope
EBAY_SCOPE_SELL_INVENTORY=https://api.ebay.com/oauth/api_scope/sell.inventory
EBAY_SCOPE_SELL_ACCOUNT=https://api.ebay.com/oauth/api_scope/sell.account
EBAY_SCOPE_SELL_ACCOUNT_READONLY=https://api.ebay.com/oauth/api_scope/sell.account.readonly
EBAY_SCOPE_SELL_FULFILLMENT=https://api.ebay.com/oauth/api_scope/sell.fulfillment
EBAY_SCOPE_SELL_FULFILLMENT_READONLY=https://api.ebay.com/oauth/api_scope/sell.fulfillment.readonly
EBAY_SCOPE_SELL_ANALYTICS=https://api.ebay.com/oauth/api_scope/sell.analytics
EBAY_SCOPE_SELL_ANALYTICS_READONLY=https://api.ebay.com/oauth/api_scope/sell.analytics.readonly
EBAY_SCOPE_SELL_COMPLIANCE=https://api.ebay.com/oauth/api_scope/sell.compliance
EBAY_SCOPE_SELL_MARKETING=https://api.ebay.com/oauth/api_scope/sell.marketing
EBAY_SCOPE_SELL_MARKETING_READONLY=https://api.ebay.com/oauth/api_scope/sell.marketing.readonly
EBAY_SCOPE_COMMERCE_CATALOG_READONLY=https://api.ebay.com/oauth/api_scope/commerce.catalog.readonly
EBAY_SCOPE_BUY_ORDER_READONLY=https://api.ebay.com/oauth/api_scope/buy.order.readonly
EBAY_SCOPE_COMMERCE_IDENTITY_READONLY=https://api.ebay.com/oauth/api_scope/commerce.identity.readonly
EBAY_SCOPE_COMMERCE_NOTIFICATION_SUBSCRIPTION=https://api.ebay.com/oauth/api_scope/commerce.notification.subscription
EBAY_SCOPE_COMMERCE_NOTIFICATION_SUBSCRIPTION_READONLY=https://api.ebay.com/oauth/api_scope/commerce.notification.subscription.readonly
EBAY_SCOPE_SELL_REPUTATION=https://api.ebay.com/oauth/api_scope/sell.reputation

# API Endpoints
EBAY_URL_INVENTORY_ITEMS=/sell/inventory/v1/inventory_item
EBAY_URL_OFFERS=/sell/inventory/v1/offer
EBAY_URL_POLICIES_PAYMENT=/sell/account/v1/payment_policy
EBAY_URL_POLICIES_RETURN=/sell/account/v1/return_policy
EBAY_URL_POLICIES_FULFILLMENT=/sell/account/v1/fulfillment_policy
EBAY_URL_ORDERS=/sell/fulfillment/v1/order
EBAY_URL_CATEGORY_TREE=/commerce/taxonomy/v1/category_tree
EBAY_URL_MARKETING=/sell/marketing/v1

# OAuth URLs
EBAY_OAUTH_TOKEN_URL=https://api.ebay.com/identity/v1/oauth2/token
EBAY_OAUTH_AUTHORIZE_URL=https://auth.ebay.com/oauth2/authorize

# Note: User-specific eBay credentials are stored in database (platform_mappings table)
# Each user has their own:
# - ebay_client_id, ebay_client_secret, ebay_refresh_token
# - ebay_app_id, ebay_dev_id, ebay_cert_id
# - ebay_payment_policy_id, ebay_fulfillment_policy_id, ebay_return_policy_id
# - Pricing coefficients & fees per marketplace
# - Best Offer settings
# - Promoted Listings settings

# -----------------------------------------------------------------------------
# ETSY - API Configuration
# -----------------------------------------------------------------------------
# OAuth2 Credentials (get from https://www.etsy.com/developers/your-apps)
ETSY_API_KEY=your-etsy-client-id-here
ETSY_API_SECRET=your-etsy-client-secret-here
ETSY_REDIRECT_URI=http://localhost:3000/etsy/callback

# Base URLs
ETSY_API_BASE=https://api.etsy.com/v3
ETSY_OAUTH_BASE=https://www.etsy.com/oauth
ETSY_AUTHORIZE_URL=https://www.etsy.com/oauth/connect
ETSY_TOKEN_URL=https://api.etsy.com/v3/public/oauth/token

# Request Settings
ETSY_REQUEST_TIMEOUT=30
ETSY_API_LIMIT=100

# Rate Limiting
ETSY_RATE_LIMIT_PER_SECOND=10
ETSY_RATE_LIMIT_PER_DAY=10000

# Polling Settings (Etsy has NO native webhooks)
ETSY_POLLING_INTERVAL_ORDERS=5  # minutes
ETSY_POLLING_INTERVAL_LISTINGS=15  # minutes
ETSY_POLLING_LOW_STOCK_THRESHOLD=5

# OAuth2 Scopes (8 scopes)
ETSY_SCOPE_LISTINGS_R=listings_r
ETSY_SCOPE_LISTINGS_W=listings_w
ETSY_SCOPE_LISTINGS_D=listings_d
ETSY_SCOPE_TRANSACTIONS_R=transactions_r
ETSY_SCOPE_TRANSACTIONS_W=transactions_w
ETSY_SCOPE_SHOPS_R=shops_r
ETSY_SCOPE_SHOPS_W=shops_w
ETSY_SCOPE_EMAIL_R=email_r

# Token Expiry
ETSY_ACCESS_TOKEN_EXPIRY_HOURS=1  # 1 hour
ETSY_REFRESH_TOKEN_EXPIRY_DAYS=90  # 90 days

# Note: User-specific Etsy credentials are stored in database (platform_mappings table)
# Each user has their own:
# - shop_id, shop_name
# - access_token, refresh_token (with expiry dates)
# - shipping_profile_id, return_policy_id
# - Shop sections configuration

# -----------------------------------------------------------------------------
# MONITORING & METRICS
# -----------------------------------------------------------------------------
SENTRY_DSN=  # À remplir en production
SENTRY_ENVIRONMENT=development
SENTRY_TRACES_SAMPLE_RATE=0.1
